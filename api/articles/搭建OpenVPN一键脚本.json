{"title":"搭建OpenVPN一键脚本","uid":"b64f86f375be7a8ad6ccdf0519ba2e1e","slug":"搭建OpenVPN一键脚本","date":"2024-09-30T05:39:32.999Z","updated":"2024-09-30T05:39:34.826Z","comments":true,"path":"api/articles/搭建OpenVPN一键脚本.json","keywords":null,"cover":null,"content":"<h2 id=\"直接展示脚本\"><a href=\"#直接展示脚本\" class=\"headerlink\" title=\"直接展示脚本\"></a>直接展示脚本</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br><span class=\"line\">852</span><br><span class=\"line\">853</span><br><span class=\"line\">854</span><br><span class=\"line\">855</span><br><span class=\"line\">856</span><br><span class=\"line\">857</span><br><span class=\"line\">858</span><br><span class=\"line\">859</span><br><span class=\"line\">860</span><br><span class=\"line\">861</span><br><span class=\"line\">862</span><br><span class=\"line\">863</span><br><span class=\"line\">864</span><br><span class=\"line\">865</span><br><span class=\"line\">866</span><br><span class=\"line\">867</span><br><span class=\"line\">868</span><br><span class=\"line\">869</span><br><span class=\"line\">870</span><br><span class=\"line\">871</span><br><span class=\"line\">872</span><br><span class=\"line\">873</span><br><span class=\"line\">874</span><br><span class=\"line\">875</span><br><span class=\"line\">876</span><br><span class=\"line\">877</span><br><span class=\"line\">878</span><br><span class=\"line\">879</span><br><span class=\"line\">880</span><br><span class=\"line\">881</span><br><span class=\"line\">882</span><br><span class=\"line\">883</span><br><span class=\"line\">884</span><br><span class=\"line\">885</span><br><span class=\"line\">886</span><br><span class=\"line\">887</span><br><span class=\"line\">888</span><br><span class=\"line\">889</span><br><span class=\"line\">890</span><br><span class=\"line\">891</span><br><span class=\"line\">892</span><br><span class=\"line\">893</span><br><span class=\"line\">894</span><br><span class=\"line\">895</span><br><span class=\"line\">896</span><br><span class=\"line\">897</span><br><span class=\"line\">898</span><br><span class=\"line\">899</span><br><span class=\"line\">900</span><br><span class=\"line\">901</span><br><span class=\"line\">902</span><br><span class=\"line\">903</span><br><span class=\"line\">904</span><br><span class=\"line\">905</span><br><span class=\"line\">906</span><br><span class=\"line\">907</span><br><span class=\"line\">908</span><br><span class=\"line\">909</span><br><span class=\"line\">910</span><br><span class=\"line\">911</span><br><span class=\"line\">912</span><br><span class=\"line\">913</span><br><span class=\"line\">914</span><br><span class=\"line\">915</span><br><span class=\"line\">916</span><br><span class=\"line\">917</span><br><span class=\"line\">918</span><br><span class=\"line\">919</span><br><span class=\"line\">920</span><br><span class=\"line\">921</span><br><span class=\"line\">922</span><br><span class=\"line\">923</span><br><span class=\"line\">924</span><br><span class=\"line\">925</span><br><span class=\"line\">926</span><br><span class=\"line\">927</span><br><span class=\"line\">928</span><br><span class=\"line\">929</span><br><span class=\"line\">930</span><br><span class=\"line\">931</span><br><span class=\"line\">932</span><br><span class=\"line\">933</span><br><span class=\"line\">934</span><br><span class=\"line\">935</span><br><span class=\"line\">936</span><br><span class=\"line\">937</span><br><span class=\"line\">938</span><br><span class=\"line\">939</span><br><span class=\"line\">940</span><br><span class=\"line\">941</span><br><span class=\"line\">942</span><br><span class=\"line\">943</span><br><span class=\"line\">944</span><br><span class=\"line\">945</span><br><span class=\"line\">946</span><br><span class=\"line\">947</span><br><span class=\"line\">948</span><br><span class=\"line\">949</span><br><span class=\"line\">950</span><br><span class=\"line\">951</span><br><span class=\"line\">952</span><br><span class=\"line\">953</span><br><span class=\"line\">954</span><br><span class=\"line\">955</span><br><span class=\"line\">956</span><br><span class=\"line\">957</span><br><span class=\"line\">958</span><br><span class=\"line\">959</span><br><span class=\"line\">960</span><br><span class=\"line\">961</span><br><span class=\"line\">962</span><br><span class=\"line\">963</span><br><span class=\"line\">964</span><br><span class=\"line\">965</span><br><span class=\"line\">966</span><br><span class=\"line\">967</span><br><span class=\"line\">968</span><br><span class=\"line\">969</span><br><span class=\"line\">970</span><br><span class=\"line\">971</span><br><span class=\"line\">972</span><br><span class=\"line\">973</span><br><span class=\"line\">974</span><br><span class=\"line\">975</span><br><span class=\"line\">976</span><br><span class=\"line\">977</span><br><span class=\"line\">978</span><br><span class=\"line\">979</span><br><span class=\"line\">980</span><br><span class=\"line\">981</span><br><span class=\"line\">982</span><br><span class=\"line\">983</span><br><span class=\"line\">984</span><br><span class=\"line\">985</span><br><span class=\"line\">986</span><br><span class=\"line\">987</span><br><span class=\"line\">988</span><br><span class=\"line\">989</span><br><span class=\"line\">990</span><br><span class=\"line\">991</span><br><span class=\"line\">992</span><br><span class=\"line\">993</span><br><span class=\"line\">994</span><br><span class=\"line\">995</span><br><span class=\"line\">996</span><br><span class=\"line\">997</span><br><span class=\"line\">998</span><br><span class=\"line\">999</span><br><span class=\"line\">1000</span><br><span class=\"line\">1001</span><br><span class=\"line\">1002</span><br><span class=\"line\">1003</span><br><span class=\"line\">1004</span><br><span class=\"line\">1005</span><br><span class=\"line\">1006</span><br><span class=\"line\">1007</span><br><span class=\"line\">1008</span><br><span class=\"line\">1009</span><br><span class=\"line\">1010</span><br><span class=\"line\">1011</span><br><span class=\"line\">1012</span><br><span class=\"line\">1013</span><br><span class=\"line\">1014</span><br><span class=\"line\">1015</span><br><span class=\"line\">1016</span><br><span class=\"line\">1017</span><br><span class=\"line\">1018</span><br><span class=\"line\">1019</span><br><span class=\"line\">1020</span><br><span class=\"line\">1021</span><br><span class=\"line\">1022</span><br><span class=\"line\">1023</span><br><span class=\"line\">1024</span><br><span class=\"line\">1025</span><br><span class=\"line\">1026</span><br><span class=\"line\">1027</span><br><span class=\"line\">1028</span><br><span class=\"line\">1029</span><br><span class=\"line\">1030</span><br><span class=\"line\">1031</span><br><span class=\"line\">1032</span><br><span class=\"line\">1033</span><br><span class=\"line\">1034</span><br><span class=\"line\">1035</span><br><span class=\"line\">1036</span><br><span class=\"line\">1037</span><br><span class=\"line\">1038</span><br><span class=\"line\">1039</span><br><span class=\"line\">1040</span><br><span class=\"line\">1041</span><br><span class=\"line\">1042</span><br><span class=\"line\">1043</span><br><span class=\"line\">1044</span><br><span class=\"line\">1045</span><br><span class=\"line\">1046</span><br><span class=\"line\">1047</span><br><span class=\"line\">1048</span><br><span class=\"line\">1049</span><br><span class=\"line\">1050</span><br><span class=\"line\">1051</span><br><span class=\"line\">1052</span><br><span class=\"line\">1053</span><br><span class=\"line\">1054</span><br><span class=\"line\">1055</span><br><span class=\"line\">1056</span><br><span class=\"line\">1057</span><br><span class=\"line\">1058</span><br><span class=\"line\">1059</span><br><span class=\"line\">1060</span><br><span class=\"line\">1061</span><br><span class=\"line\">1062</span><br><span class=\"line\">1063</span><br><span class=\"line\">1064</span><br><span class=\"line\">1065</span><br><span class=\"line\">1066</span><br><span class=\"line\">1067</span><br><span class=\"line\">1068</span><br><span class=\"line\">1069</span><br><span class=\"line\">1070</span><br><span class=\"line\">1071</span><br><span class=\"line\">1072</span><br><span class=\"line\">1073</span><br><span class=\"line\">1074</span><br><span class=\"line\">1075</span><br><span class=\"line\">1076</span><br><span class=\"line\">1077</span><br><span class=\"line\">1078</span><br><span class=\"line\">1079</span><br><span class=\"line\">1080</span><br><span class=\"line\">1081</span><br><span class=\"line\">1082</span><br><span class=\"line\">1083</span><br><span class=\"line\">1084</span><br><span class=\"line\">1085</span><br><span class=\"line\">1086</span><br><span class=\"line\">1087</span><br><span class=\"line\">1088</span><br><span class=\"line\">1089</span><br><span class=\"line\">1090</span><br><span class=\"line\">1091</span><br><span class=\"line\">1092</span><br><span class=\"line\">1093</span><br><span class=\"line\">1094</span><br><span class=\"line\">1095</span><br><span class=\"line\">1096</span><br><span class=\"line\">1097</span><br><span class=\"line\">1098</span><br><span class=\"line\">1099</span><br><span class=\"line\">1100</span><br><span class=\"line\">1101</span><br><span class=\"line\">1102</span><br><span class=\"line\">1103</span><br><span class=\"line\">1104</span><br><span class=\"line\">1105</span><br><span class=\"line\">1106</span><br><span class=\"line\">1107</span><br><span class=\"line\">1108</span><br><span class=\"line\">1109</span><br><span class=\"line\">1110</span><br><span class=\"line\">1111</span><br><span class=\"line\">1112</span><br><span class=\"line\">1113</span><br><span class=\"line\">1114</span><br><span class=\"line\">1115</span><br><span class=\"line\">1116</span><br><span class=\"line\">1117</span><br><span class=\"line\">1118</span><br><span class=\"line\">1119</span><br><span class=\"line\">1120</span><br><span class=\"line\">1121</span><br><span class=\"line\">1122</span><br><span class=\"line\">1123</span><br><span class=\"line\">1124</span><br><span class=\"line\">1125</span><br><span class=\"line\">1126</span><br><span class=\"line\">1127</span><br><span class=\"line\">1128</span><br><span class=\"line\">1129</span><br><span class=\"line\">1130</span><br><span class=\"line\">1131</span><br><span class=\"line\">1132</span><br><span class=\"line\">1133</span><br><span class=\"line\">1134</span><br><span class=\"line\">1135</span><br><span class=\"line\">1136</span><br><span class=\"line\">1137</span><br><span class=\"line\">1138</span><br><span class=\"line\">1139</span><br><span class=\"line\">1140</span><br><span class=\"line\">1141</span><br><span class=\"line\">1142</span><br><span class=\"line\">1143</span><br><span class=\"line\">1144</span><br><span class=\"line\">1145</span><br><span class=\"line\">1146</span><br><span class=\"line\">1147</span><br><span class=\"line\">1148</span><br><span class=\"line\">1149</span><br><span class=\"line\">1150</span><br><span class=\"line\">1151</span><br><span class=\"line\">1152</span><br><span class=\"line\">1153</span><br><span class=\"line\">1154</span><br><span class=\"line\">1155</span><br><span class=\"line\">1156</span><br><span class=\"line\">1157</span><br><span class=\"line\">1158</span><br><span class=\"line\">1159</span><br><span class=\"line\">1160</span><br><span class=\"line\">1161</span><br><span class=\"line\">1162</span><br><span class=\"line\">1163</span><br><span class=\"line\">1164</span><br><span class=\"line\">1165</span><br><span class=\"line\">1166</span><br><span class=\"line\">1167</span><br><span class=\"line\">1168</span><br><span class=\"line\">1169</span><br><span class=\"line\">1170</span><br><span class=\"line\">1171</span><br><span class=\"line\">1172</span><br><span class=\"line\">1173</span><br><span class=\"line\">1174</span><br><span class=\"line\">1175</span><br><span class=\"line\">1176</span><br><span class=\"line\">1177</span><br><span class=\"line\">1178</span><br><span class=\"line\">1179</span><br><span class=\"line\">1180</span><br><span class=\"line\">1181</span><br><span class=\"line\">1182</span><br><span class=\"line\">1183</span><br><span class=\"line\">1184</span><br><span class=\"line\">1185</span><br><span class=\"line\">1186</span><br><span class=\"line\">1187</span><br><span class=\"line\">1188</span><br><span class=\"line\">1189</span><br><span class=\"line\">1190</span><br><span class=\"line\">1191</span><br><span class=\"line\">1192</span><br><span class=\"line\">1193</span><br><span class=\"line\">1194</span><br><span class=\"line\">1195</span><br><span class=\"line\">1196</span><br><span class=\"line\">1197</span><br><span class=\"line\">1198</span><br><span class=\"line\">1199</span><br><span class=\"line\">1200</span><br><span class=\"line\">1201</span><br><span class=\"line\">1202</span><br><span class=\"line\">1203</span><br><span class=\"line\">1204</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">function isRoot () &#123;</span><br><span class=\"line\">\tif [ &quot;$EUID&quot; -ne 0 ]; then</span><br><span class=\"line\">\t\treturn 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function tunAvailable () &#123;</span><br><span class=\"line\">\tif [ ! -e /dev/net/tun ]; then</span><br><span class=\"line\">\t\treturn 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function checkOS () &#123;</span><br><span class=\"line\">\tif [[ -e /etc/debian_version ]]; then</span><br><span class=\"line\">\t\tOS=&quot;debian&quot;</span><br><span class=\"line\">\t\tsource /etc/os-release</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif [[ &quot;$ID&quot; == &quot;debian&quot; ]]; then</span><br><span class=\"line\">\t\t\tif [[ ! $VERSION_ID =~ (8|9) ]]; then</span><br><span class=\"line\">\t\t\t\techo &quot;⚠️ 当前脚本不支持此Debian版本.&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;但是，如果你使用的Debian系统版本 &gt;= 9 那么你可以尝试继续.&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;请注意他们不被支持&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\tuntil [[ $CONTINUE =~ (y|n) ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp &quot;是否继续? [y/n]: &quot; -e CONTINUE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tif [[ &quot;$CONTINUE&quot; = &quot;n&quot; ]]; then</span><br><span class=\"line\">\t\t\t\t\texit 1</span><br><span class=\"line\">\t\t\t\tfi</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\t\telif [[ &quot;$ID&quot; == &quot;ubuntu&quot; ]];then</span><br><span class=\"line\">\t\t\tOS=&quot;ubuntu&quot;</span><br><span class=\"line\">\t\t\tif [[ ! $VERSION_ID =~ (16.04|18.04) ]]; then</span><br><span class=\"line\">\t\t\t\techo &quot;⚠️ 当前脚本不支持此Ubuntu版本.&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;但是，如果你使用的Ubuntu系统版本 &gt; 17 or beta, 你可以继续安装.&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;请注意他们不被支持&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\tuntil [[ $CONTINUE =~ (y|n) ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp &quot;是否继续? [y/n]: &quot; -e CONTINUE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tif [[ &quot;$CONTINUE&quot; = &quot;n&quot; ]]; then</span><br><span class=\"line\">\t\t\t\t\texit 1</span><br><span class=\"line\">\t\t\t\tfi</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\telif [[ -e /etc/fedora-release ]]; then</span><br><span class=\"line\">\t\tOS=fedora</span><br><span class=\"line\">\telif [[ -e /etc/centos-release ]]; then</span><br><span class=\"line\">\t\tif ! grep -qs &quot;^CentOS Linux release 7&quot; /etc/centos-release; then</span><br><span class=\"line\">\t\t\techo &quot;你的 CentOS 版本无法运行此脚本.&quot;</span><br><span class=\"line\">\t\t\techo &quot;此脚本只能在 CentOS 7 中运行.&quot;</span><br><span class=\"line\">\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\tunset CONTINUE</span><br><span class=\"line\">\t\t\tuntil [[ $CONTINUE =~ (y|n) ]]; do</span><br><span class=\"line\">\t\t\t\tread -rp &quot;是否继续? [y/n]: &quot; -e CONTINUE</span><br><span class=\"line\">\t\t\tdone</span><br><span class=\"line\">\t\t\tif [[ &quot;$CONTINUE&quot; = &quot;n&quot; ]]; then</span><br><span class=\"line\">\t\t\t\techo &quot;好吧,再见!&quot;</span><br><span class=\"line\">\t\t\t\texit 1</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t\tOS=centos</span><br><span class=\"line\">\telif [[ -e /etc/arch-release ]]; then</span><br><span class=\"line\">\t\tOS=arch</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;发现你运行的Linux版本不在以下范围内: Debian, Ubuntu, Fedora, CentOS or Arch Linux system&quot;</span><br><span class=\"line\">\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function initialCheck () &#123;</span><br><span class=\"line\">\tif ! isRoot; then</span><br><span class=\"line\">\t\techo &quot;请使用root来进行操作&quot;</span><br><span class=\"line\">\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tif ! tunAvailable; then</span><br><span class=\"line\">\t\techo &quot;TUN 不可用&quot;</span><br><span class=\"line\">\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tcheckOS</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function installUnbound () &#123;</span><br><span class=\"line\">\tif [[ ! -e /etc/unbound/unbound.conf ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif [[ &quot;$OS&quot; =~ (debian|ubuntu) ]]; then</span><br><span class=\"line\">\t\t\tapt-get install -y unbound</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t# Configuration</span><br><span class=\"line\">\t\t\techo &#x27;interface: 10.8.0.1</span><br><span class=\"line\">access-control: 10.8.0.1/24 allow</span><br><span class=\"line\">hide-identity: yes</span><br><span class=\"line\">hide-version: yes</span><br><span class=\"line\">use-caps-for-id: yes</span><br><span class=\"line\">prefetch: yes&#x27; &gt;&gt; /etc/unbound/unbound.conf</span><br><span class=\"line\"></span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &quot;centos&quot; ]]; then</span><br><span class=\"line\">\t\t\tyum install -y unbound</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t# Configuration</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# interface: 0.0.0.0$|interface: 10.8.0.1|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# access-control: 127.0.0.0/8 allow|access-control: 10.8.0.1/24 allow|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# hide-identity: no|hide-identity: yes|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# hide-version: no|hide-version: yes|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|use-caps-for-id: no|use-caps-for-id: yes|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\"></span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &quot;fedora&quot; ]]; then</span><br><span class=\"line\">\t\t\tdnf install -y unbound</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t# Configuration</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# interface: 0.0.0.0$|interface: 10.8.0.1|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# access-control: 127.0.0.0/8 allow|access-control: 10.8.0.1/24 allow|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# hide-identity: no|hide-identity: yes|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# hide-version: no|hide-version: yes|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|# use-caps-for-id: no|use-caps-for-id: yes|&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\"></span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &quot;arch&quot; ]]; then</span><br><span class=\"line\">\t\t\tpacman -Syu --noconfirm unbound</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t# Get root servers list</span><br><span class=\"line\">\t\t\tcurl -o /etc/unbound/root.hints https://www.internic.net/domain/named.cache</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tmv /etc/unbound/unbound.conf /etc/unbound/unbound.conf.old</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\t\techo &#x27;server:</span><br><span class=\"line\">\tuse-syslog: yes</span><br><span class=\"line\">\tdo-daemonize: no</span><br><span class=\"line\">\tusername: &quot;unbound&quot;</span><br><span class=\"line\">\tdirectory: &quot;/etc/unbound&quot;</span><br><span class=\"line\">\ttrust-anchor-file: trusted-key.key</span><br><span class=\"line\">\troot-hints: root.hints</span><br><span class=\"line\">\tinterface: 10.8.0.1</span><br><span class=\"line\">\taccess-control: 10.8.0.1/24 allow</span><br><span class=\"line\">\tport: 53</span><br><span class=\"line\">\tnum-threads: 2</span><br><span class=\"line\">\tuse-caps-for-id: yes</span><br><span class=\"line\">\tharden-glue: yes</span><br><span class=\"line\">\thide-identity: yes</span><br><span class=\"line\">\thide-version: yes</span><br><span class=\"line\">\tqname-minimisation: yes</span><br><span class=\"line\">\tprefetch: yes&#x27; &gt; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif [[ ! &quot;$OS&quot; =~ (fedora|centos) ]];then</span><br><span class=\"line\">\t\t\t# DNS Rebinding fix</span><br><span class=\"line\">\t\t\techo &quot;private-address: 10.0.0.0/8</span><br><span class=\"line\">private-address: 172.16.0.0/12</span><br><span class=\"line\">private-address: 192.168.0.0/16</span><br><span class=\"line\">private-address: 169.254.0.0/16</span><br><span class=\"line\">private-address: fd00::/8</span><br><span class=\"line\">private-address: fe80::/10</span><br><span class=\"line\">private-address: 127.0.0.0/8</span><br><span class=\"line\">private-address: ::ffff:0:0/96&quot; &gt;&gt; /etc/unbound/unbound.conf</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\telse # Unbound is already installed</span><br><span class=\"line\">\t\techo &#x27;include: /etc/unbound/openvpn.conf&#x27; &gt;&gt; /etc/unbound/unbound.conf</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Add Unbound &#x27;server&#x27; for the OpenVPN subnet</span><br><span class=\"line\">\t\techo &#x27;server:</span><br><span class=\"line\">interface: 10.8.0.1</span><br><span class=\"line\">access-control: 10.8.0.1/24 allow</span><br><span class=\"line\">hide-identity: yes</span><br><span class=\"line\">hide-version: yes</span><br><span class=\"line\">use-caps-for-id: yes</span><br><span class=\"line\">prefetch: yes</span><br><span class=\"line\">private-address: 10.0.0.0/8</span><br><span class=\"line\">private-address: 172.16.0.0/12</span><br><span class=\"line\">private-address: 192.168.0.0/16</span><br><span class=\"line\">private-address: 169.254.0.0/16</span><br><span class=\"line\">private-address: fd00::/8</span><br><span class=\"line\">private-address: fe80::/10</span><br><span class=\"line\">private-address: 127.0.0.0/8</span><br><span class=\"line\">private-address: ::ffff:0:0/96&#x27; &gt; /etc/unbound/openvpn.conf</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tsystemctl enable unbound</span><br><span class=\"line\">\t\tsystemctl restart unbound</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function installQuestions () &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;将会询问您一些必要的安装用的信息.&quot;</span><br><span class=\"line\">\techo &quot;你可以修改默认选项或者一直按回车使用这些默认选项.&quot;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;我需要获取当前网络的 IPv4 地址 确保OpenVPN的正常安装.&quot;</span><br><span class=\"line\">\techo &quot;除非你想要使用局域网，你需要有一个公网IP.&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Detect public IPv4 address and pre-fill for the user</span><br><span class=\"line\">\tIP=$(ip addr | grep &#x27;inet&#x27; | grep -v inet6 | grep -vE &#x27;127\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;&#x27; | grep -oE &#x27;[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;&#x27; | head -1)</span><br><span class=\"line\">\tread -rp &quot;IP address: &quot; -e -i &quot;$IP&quot; IP</span><br><span class=\"line\">\t# If $IP is a private IP address, the server must be behind NAT</span><br><span class=\"line\">\tif echo &quot;$IP&quot; | grep -qE &#x27;^(10\\.|172\\.1[6789]\\.|172\\.2[0-9]\\.|172\\.3[01]\\.|192\\.168)&#x27;; then</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;这看起来像是局域网，你的公网IP地址什么?&quot;</span><br><span class=\"line\">\t\techo &quot;我们需要它来确保你的客户端连接此服务端.&quot;</span><br><span class=\"line\">\t\tuntil [[ &quot;$PUBLICIP&quot; != &quot;&quot; ]]; do</span><br><span class=\"line\">\t\t\tread -rp &quot;公网IPv4地址或者域名: &quot; -e PUBLICIP</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;检查IPv6连通性...&quot;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\t# &quot;ping6&quot; and &quot;ping -6&quot; availability varies depending on the distribution</span><br><span class=\"line\">\tif type ping6 &gt; /dev/null 2&gt;&amp;1; then</span><br><span class=\"line\">\t\tPING6=&quot;ping6 -c3 ipv6.google.com &gt; /dev/null 2&gt;&amp;1&quot;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\tPING6=&quot;ping -6 -c3 ipv6.google.com &gt; /dev/null 2&gt;&amp;1&quot;</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tif eval &quot;$PING6&quot;; then</span><br><span class=\"line\">\t\techo &quot;当前host IPv6 连通性正常.&quot;</span><br><span class=\"line\">\t\tSUGGESTION=&quot;y&quot;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;当前host IPv6 连通性不正常.&quot;</span><br><span class=\"line\">\t\tSUGGESTION=&quot;n&quot;</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\t# Ask the user if they want to enable IPv6 regardless its availability.</span><br><span class=\"line\">\tuntil [[ $IPV6_SUPPORT =~ (y|n) ]]; do</span><br><span class=\"line\">\t\tread -rp &quot;是否启用 IPv6 支持 (NAT)? [y/n]: &quot; -e -i $SUGGESTION IPV6_SUPPORT</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;请选择 OpenVPN 监听的端口?&quot;</span><br><span class=\"line\">\techo &quot;   1) 默认: 1194&quot;</span><br><span class=\"line\">\techo &quot;   2) 输入&quot;</span><br><span class=\"line\">\techo &quot;   3) 随机 [49152-65535]&quot;</span><br><span class=\"line\">\tuntil [[ &quot;$PORT_CHOICE&quot; =~ ^[1-3]$ ]]; do</span><br><span class=\"line\">\t\tread -rp &quot;端口选项 [1-3]: &quot; -e -i 1 PORT_CHOICE</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">\tcase $PORT_CHOICE in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\tPORT=&quot;1194&quot;</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\t\tuntil [[ &quot;$PORT&quot; =~ ^[0-9]+$ ]] &amp;&amp; [ &quot;$PORT&quot; -ge 1 ] &amp;&amp; [ &quot;$PORT&quot; -le 65535 ]; do</span><br><span class=\"line\">\t\t\t\tread -rp &quot;输入端口 [1-65535]: &quot; -e -i 1194 PORT</span><br><span class=\"line\">\t\t\tdone</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t3)</span><br><span class=\"line\">\t\t\t# Generate random number within private ports range</span><br><span class=\"line\">\t\t\tPORT=$(shuf -i49152-65535 -n1)</span><br><span class=\"line\">\t\t\techo &quot;随机端口: $PORT&quot;</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;OpenVPN 使用什么协议 UDP/TCP?&quot;</span><br><span class=\"line\">\techo &quot;UDP 十分快速. 除非UDP无法使用，不推荐使用TCP.&quot;</span><br><span class=\"line\">\techo &quot;   1) UDP&quot;</span><br><span class=\"line\">\techo &quot;   2) TCP&quot;</span><br><span class=\"line\">\tuntil [[ &quot;$PROTOCOL_CHOICE&quot; =~ ^[1-2]$ ]]; do</span><br><span class=\"line\">\t\tread -rp &quot;Protocol [1-2]: &quot; -e -i 1 PROTOCOL_CHOICE</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">\tcase $PROTOCOL_CHOICE in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\tPROTOCOL=&quot;udp&quot;</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\t\tPROTOCOL=&quot;tcp&quot;</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;您希望将哪个DNS解析服务用于VPN ?&quot;</span><br><span class=\"line\">\techo &quot;   1) 正确的系统解析器 (from /etc/resolv.conf)&quot;</span><br><span class=\"line\">\techo &quot;   2) 当前host DNS 解析器 (Unbound)&quot;</span><br><span class=\"line\">\techo &quot;   3) Cloudflare (Anycast: worldwide)&quot;</span><br><span class=\"line\">\techo &quot;   4) Quad9 (Anycast: worldwide)&quot;</span><br><span class=\"line\">\techo &quot;   5) Quad9 uncensored (Anycast: worldwide)&quot;</span><br><span class=\"line\">\techo &quot;   6) FDN (France)&quot;</span><br><span class=\"line\">\techo &quot;   7) DNS.WATCH (Germany)&quot;</span><br><span class=\"line\">\techo &quot;   8) OpenDNS (Anycast: worldwide)&quot;</span><br><span class=\"line\">\techo &quot;   9) Google (Anycast: worldwide)&quot;</span><br><span class=\"line\">\techo &quot;   10) Yandex Basic (Russia)&quot;</span><br><span class=\"line\">\techo &quot;   11) AdGuard DNS (Russia)&quot;</span><br><span class=\"line\">\tuntil [[ &quot;$DNS&quot; =~ ^[0-9]+$ ]] &amp;&amp; [ &quot;$DNS&quot; -ge 1 ] &amp;&amp; [ &quot;$DNS&quot; -le 11 ]; do</span><br><span class=\"line\">\t\tread -rp &quot;DNS [1-10]: &quot; -e -i 3 DNS</span><br><span class=\"line\">\t\t\tif [[ $DNS == 2 ]] &amp;&amp; [[ -e /etc/unbound/unbound.conf ]]; then</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;Unbound 已经安装.&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;您可以允许脚本对其进行配置，以便从OpenVPN客户端使用它&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;我们将简单的添加一个服务端在 /etc/unbound/unbound.conf 对于OpenVPN子网.&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;没有对当前配置进行任何更改.&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\tuntil [[ $CONTINUE =~ (y|n) ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp &quot;将配置更改应用于Unbound? 推荐默认回车 [y/n]: &quot; -e CONTINUE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tif [[ $CONTINUE = &quot;n&quot; ]];then</span><br><span class=\"line\">\t\t\t\t\t# Break the loop and cleanup</span><br><span class=\"line\">\t\t\t\t\tunset DNS</span><br><span class=\"line\">\t\t\t\t\tunset CONTINUE</span><br><span class=\"line\">\t\t\t\tfi</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;你想使用压缩吗？ 由于VORACLE攻击使用它，因此不推荐使用它。&quot;</span><br><span class=\"line\">\tuntil [[ $COMPRESSION_ENABLED =~ (y|n) ]]; do</span><br><span class=\"line\">\t\tread -rp&quot;启用压缩 推荐默认回车? [y/n]: &quot; -e -i n COMPRESSION_ENABLED</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">\tif [[ $COMPRESSION_ENABLED == &quot;y&quot; ]];then</span><br><span class=\"line\">\t\techo &quot;选择一个压缩算法:&quot;</span><br><span class=\"line\">\t\techo &quot;   1) LZ4 (更加效率)&quot;</span><br><span class=\"line\">\t\techo &quot;   2) LZ0&quot;</span><br><span class=\"line\">\t\tuntil [[ $COMPRESSION_CHOICE =~ ^[1-2]$ ]]; do</span><br><span class=\"line\">\t\t\tread -rp&quot;压缩算法 [1-2]: &quot; -e -i 1 COMPRESSION_CHOICE</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\t\tcase $COMPRESSION_CHOICE in</span><br><span class=\"line\">\t\t\t1)</span><br><span class=\"line\">\t\t\tCOMPRESSION_ALG=&quot;lz4&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t2)</span><br><span class=\"line\">\t\t\tCOMPRESSION_ALG=&quot;lzo&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\tesac</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;是否要自定义加密设置?&quot;</span><br><span class=\"line\">\techo &quot;Unless you know what you&#x27;re doing, you should stick with the default parameters provided by the script.&quot;</span><br><span class=\"line\">\techo &quot;除非你知道自己在做什么，否则你应该使用脚本提供的默认参数&quot;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\tuntil [[ $CUSTOMIZE_ENC =~ (y|n) ]]; do</span><br><span class=\"line\">\t\tread -rp &quot;自定义加密设置? [y/n]: &quot; -e -i n CUSTOMIZE_ENC</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">\tif [[ $CUSTOMIZE_ENC == &quot;n&quot; ]];then</span><br><span class=\"line\">\t\t# Use default, sane and fast parameters</span><br><span class=\"line\">\t\tCIPHER=&quot;AES-128-GCM&quot;</span><br><span class=\"line\">\t\tCERT_TYPE=&quot;1&quot; # ECDSA</span><br><span class=\"line\">\t\tCERT_CURVE=&quot;prime256v1&quot;</span><br><span class=\"line\">\t\tCC_CIPHER=&quot;TLS-ECDHE-ECDSA-WITH-AES-128-GCM-SHA256&quot;</span><br><span class=\"line\">\t\tDH_TYPE=&quot;1&quot; # ECDH</span><br><span class=\"line\">\t\tDH_CURVE=&quot;prime256v1&quot;</span><br><span class=\"line\">\t\tHMAC_ALG=&quot;SHA256&quot;</span><br><span class=\"line\">\t\tTLS_SIG=&quot;1&quot; # tls-crypt</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;选择要用于数据通道的加密方式:&quot;</span><br><span class=\"line\">\t\techo &quot;   1) AES-128-GCM (recommended)&quot;</span><br><span class=\"line\">\t\techo &quot;   2) AES-192-GCM&quot;</span><br><span class=\"line\">\t\techo &quot;   3) AES-256-GCM&quot;</span><br><span class=\"line\">\t\techo &quot;   4) AES-128-CBC&quot;</span><br><span class=\"line\">\t\techo &quot;   5) AES-192-CBC&quot;</span><br><span class=\"line\">\t\techo &quot;   6) AES-256-CBC&quot;</span><br><span class=\"line\">\t\tuntil [[ &quot;$CIPHER_CHOICE&quot; =~ ^[1-6]$ ]]; do</span><br><span class=\"line\">\t\t\tread -rp &quot;加密方式 [1-6]: &quot; -e -i 1 CIPHER_CHOICE</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\t\tcase $CIPHER_CHOICE in</span><br><span class=\"line\">\t\t\t1)</span><br><span class=\"line\">\t\t\t\tCIPHER=&quot;AES-128-GCM&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t2)</span><br><span class=\"line\">\t\t\t\tCIPHER=&quot;AES-192-GCM&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t3)</span><br><span class=\"line\">\t\t\t\tCIPHER=&quot;AES-256-GCM&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t4)</span><br><span class=\"line\">\t\t\t\tCIPHER=&quot;AES-128-CBC&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t5)</span><br><span class=\"line\">\t\t\t\tCIPHER=&quot;AES-192-CBC&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t6)</span><br><span class=\"line\">\t\t\t\tCIPHER=&quot;AES-256-CBC&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\tesac</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;选择您要使用的证书类型:&quot;</span><br><span class=\"line\">\t\techo &quot;   1) ECDSA (recommended)&quot;</span><br><span class=\"line\">\t\techo &quot;   2) RSA&quot;</span><br><span class=\"line\">\t\tuntil [[ $CERT_TYPE =~ ^[1-2]$ ]]; do</span><br><span class=\"line\">\t\t\tread -rp&quot;证书类型 [1-2]: &quot; -e -i 1 CERT_TYPE</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\t\tcase $CERT_TYPE in</span><br><span class=\"line\">\t\t\t1)</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;选择要用于证书密钥的协议:&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   1) prime256v1 (recommended)&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   2) secp384r1&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   3) secp521r1&quot;</span><br><span class=\"line\">\t\t\t\tuntil [[ $CERT_CURVE_CHOICE =~ ^[1-3]$ ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp&quot;Curve [1-3]: &quot; -e -i 1 CERT_CURVE_CHOICE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tcase $CERT_CURVE_CHOICE in</span><br><span class=\"line\">\t\t\t\t\t1)</span><br><span class=\"line\">\t\t\t\t\t\tCERT_CURVE=&quot;prime256v1&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t2)</span><br><span class=\"line\">\t\t\t\t\t\tCERT_CURVE=&quot;secp384r1&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t3)</span><br><span class=\"line\">\t\t\t\t\t\tCERT_CURVE=&quot;secp521r1&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\tesac</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t2)</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;选择要用于证书的RSA密钥的大小:&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   1) 2048 bits (recommended)&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   2) 3072 bits&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   3) 4096 bits&quot;</span><br><span class=\"line\">\t\t\t\tuntil [[ &quot;$RSA_KEY_SIZE_CHOICE&quot; =~ ^[1-3]$ ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp &quot;RSA key size [1-3]: &quot; -e -i 1 RSA_KEY_SIZE_CHOICE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tcase $RSA_KEY_SIZE_CHOICE in</span><br><span class=\"line\">\t\t\t\t\t1)</span><br><span class=\"line\">\t\t\t\t\t\tRSA_KEY_SIZE=&quot;2048&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t2)</span><br><span class=\"line\">\t\t\t\t\t\tRSA_KEY_SIZE=&quot;3072&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t3)</span><br><span class=\"line\">\t\t\t\t\t\tRSA_KEY_SIZE=&quot;4096&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\tesac</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\tesac</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;选择要用于控制通道的加密方式:&quot;</span><br><span class=\"line\">\t\tcase $CERT_TYPE in</span><br><span class=\"line\">\t\t\t1)</span><br><span class=\"line\">\t\t\t\techo &quot;   1) ECDHE-ECDSA-AES-128-GCM-SHA256 (recommended)&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   2) ECDHE-ECDSA-AES-256-GCM-SHA384&quot;</span><br><span class=\"line\">\t\t\t\tuntil [[ $CC_CIPHER_CHOICE =~ ^[1-2]$ ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp&quot;Control channel cipher [1-2]: &quot; -e -i 1 CC_CIPHER_CHOICE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tcase $CC_CIPHER_CHOICE in</span><br><span class=\"line\">\t\t\t\t\t1)</span><br><span class=\"line\">\t\t\t\t\t\tCC_CIPHER=&quot;TLS-ECDHE-ECDSA-WITH-AES-128-GCM-SHA256&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t2)</span><br><span class=\"line\">\t\t\t\t\t\tCC_CIPHER=&quot;TLS-ECDHE-ECDSA-WITH-AES-256-GCM-SHA384&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\tesac</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t2)</span><br><span class=\"line\">\t\t\t\techo &quot;   1) ECDHE-RSA-AES-128-GCM-SHA256 (recommended)&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   2) ECDHE-RSA-AES-256-GCM-SHA384&quot;</span><br><span class=\"line\">\t\t\t\tuntil [[ $CC_CIPHER_CHOICE =~ ^[1-2]$ ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp&quot;Control channel cipher [1-2]: &quot; -e -i 1 CC_CIPHER_CHOICE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tcase $CC_CIPHER_CHOICE in</span><br><span class=\"line\">\t\t\t\t\t1)</span><br><span class=\"line\">\t\t\t\t\t\tCC_CIPHER=&quot;TLS-ECDHE-RSA-WITH-AES-128-GCM-SHA256&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t2)</span><br><span class=\"line\">\t\t\t\t\t\tCC_CIPHER=&quot;TLS-ECDHE-RSA-WITH-AES-256-GCM-SHA384&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\tesac</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\tesac</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;选择您要使用的Diffie-Hellman口令:&quot;</span><br><span class=\"line\">\t\techo &quot;   1) ECDH (recommended)&quot;</span><br><span class=\"line\">\t\techo &quot;   2) DH&quot;</span><br><span class=\"line\">\t\tuntil [[ $DH_TYPE =~ [1-2] ]]; do</span><br><span class=\"line\">\t\t\tread -rp&quot;DH 口令类型 [1-2]: &quot; -e -i 1 DH_TYPE</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\t\tcase $DH_TYPE in</span><br><span class=\"line\">\t\t\t1)</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;选择要用于ECDH口令:&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   1) prime256v1 (recommended)&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   2) secp384r1&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   3) secp521r1&quot;</span><br><span class=\"line\">\t\t\t\twhile [[ $DH_CURVE_CHOICE != &quot;1&quot; &amp;&amp; $DH_CURVE_CHOICE != &quot;2&quot; &amp;&amp; $DH_CURVE_CHOICE != &quot;3&quot; ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp&quot;Curve [1-3]: &quot; -e -i 1 DH_CURVE_CHOICE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tcase $DH_CURVE_CHOICE in</span><br><span class=\"line\">\t\t\t\t\t1)</span><br><span class=\"line\">\t\t\t\t\t\tDH_CURVE=&quot;prime256v1&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t2)</span><br><span class=\"line\">\t\t\t\t\t\tDH_CURVE=&quot;secp384r1&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t3)</span><br><span class=\"line\">\t\t\t\t\t\tDH_CURVE=&quot;secp521r1&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\tesac</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t2)</span><br><span class=\"line\">\t\t\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;选择要使用的Diffie-Hellman键的大小:&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   1) 2048 bits (recommended)&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   2) 3072 bits&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;   3) 4096 bits&quot;</span><br><span class=\"line\">\t\t\t\tuntil [[ &quot;$DH_KEY_SIZE_CHOICE&quot; =~ ^[1-3]$ ]]; do</span><br><span class=\"line\">\t\t\t\t\tread -rp &quot;DH key size [1-3]: &quot; -e -i 1 DH_KEY_SIZE_CHOICE</span><br><span class=\"line\">\t\t\t\tdone</span><br><span class=\"line\">\t\t\t\tcase $DH_KEY_SIZE_CHOICE in</span><br><span class=\"line\">\t\t\t\t\t1)</span><br><span class=\"line\">\t\t\t\t\t\tDH_KEY_SIZE=&quot;2048&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t2)</span><br><span class=\"line\">\t\t\t\t\t\tDH_KEY_SIZE=&quot;3072&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\t\t3)</span><br><span class=\"line\">\t\t\t\t\t\tDH_KEY_SIZE=&quot;4096&quot;</span><br><span class=\"line\">\t\t\t\t\t;;</span><br><span class=\"line\">\t\t\t\tesac</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\tesac</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\t# The &quot;auth&quot; options behaves differently with AEAD ciphers</span><br><span class=\"line\">\t\tif [[ &quot;$CIPHER&quot; =~ CBC$ ]]; then</span><br><span class=\"line\">\t\t\techo &quot;摘要算法验证来自控制信道的数据信道分组和tls-auth分组.&quot;</span><br><span class=\"line\">\t\telif [[ &quot;$CIPHER&quot; =~ GCM$ ]]; then</span><br><span class=\"line\">\t\t\techo &quot;摘要算法验证来自控制信道的tls-auth数据包.&quot;</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t\techo &quot;哪种摘要算法用于你的 HMAC?&quot;</span><br><span class=\"line\">\t\techo &quot;   1) SHA-256 (recommended)&quot;</span><br><span class=\"line\">\t\techo &quot;   2) SHA-384&quot;</span><br><span class=\"line\">\t\techo &quot;   3) SHA-512&quot;</span><br><span class=\"line\">\t\tuntil [[ $HMAC_ALG_CHOICE =~ ^[1-3]$ ]]; do</span><br><span class=\"line\">\t\t\tread -rp &quot;Digest algorithm [1-3]: &quot; -e -i 1 HMAC_ALG_CHOICE</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\t\tcase $HMAC_ALG_CHOICE in</span><br><span class=\"line\">\t\t\t1)</span><br><span class=\"line\">\t\t\t\tHMAC_ALG=&quot;SHA256&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t2)</span><br><span class=\"line\">\t\t\t\tHMAC_ALG=&quot;SHA384&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t3)</span><br><span class=\"line\">\t\t\t\tHMAC_ALG=&quot;SHA512&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\tesac</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;您可以使用tls-auth和tls-crypt向控制通道添加额外的安全层&quot;</span><br><span class=\"line\">\t\techo &quot;tls-auth对数据包进行身份验证，而tls-crypt对其进行身份验证和加密.&quot;</span><br><span class=\"line\">\t\techo &quot;   1) tls-crypt (recommended)&quot;</span><br><span class=\"line\">\t\techo &quot;   2) tls-auth&quot;</span><br><span class=\"line\">\t\tuntil [[ $TLS_SIG =~ [1-2] ]]; do</span><br><span class=\"line\">\t\t\t\tread -rp &quot;Control channel additional security mechanism [1-2]: &quot; -e -i 1 TLS_SIG</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;安装信息收集完成，现在准备好设置您的OpenVPN服务器.&quot;</span><br><span class=\"line\">\techo &quot;您将能够在安装结束时生成客户端.&quot;</span><br><span class=\"line\">\tread -n1 -r -p &quot;按下任意键继续...&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function installOpenVPN () &#123;</span><br><span class=\"line\">\t# Run setup questions first</span><br><span class=\"line\">\tinstallQuestions</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Get the &quot;public&quot; interface from the default route</span><br><span class=\"line\">\tNIC=$(ip -4 route ls | grep default | grep -Po &#x27;(?&lt;=dev )(\\S+)&#x27; | head -1)</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ &quot;$OS&quot; =~ (debian|ubuntu) ]]; then</span><br><span class=\"line\">\t\tapt-get update</span><br><span class=\"line\">\t\tapt-get -y install ca-certificates gnupg</span><br><span class=\"line\">\t\t# We add the OpenVPN repo to get the latest version.</span><br><span class=\"line\">\t\tif [[ &quot;$VERSION_ID&quot; = &quot;8&quot; ]]; then</span><br><span class=\"line\">\t\t\techo &quot;deb http://build.openvpn.net/debian/openvpn/stable jessie main&quot; &gt; /etc/apt/sources.list.d/openvpn.list</span><br><span class=\"line\">\t\t\twget -O - https://swupdate.openvpn.net/repos/repo-public.gpg | apt-key add -</span><br><span class=\"line\">\t\t\tapt-get update</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t\tif [[ &quot;$VERSION_ID&quot; = &quot;16.04&quot; ]]; then</span><br><span class=\"line\">\t\t\techo &quot;deb http://build.openvpn.net/debian/openvpn/stable trusty main&quot; &gt; /etc/apt/sources.list.d/openvpn.list</span><br><span class=\"line\">\t\t\twget -O - https://swupdate.openvpn.net/repos/repo-public.gpg | apt-key add -</span><br><span class=\"line\">\t\t\tapt-get update</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t\t# Ubuntu &gt; 16.04 and Debian &gt; 8 have OpenVPN &gt;= 2.4 without the need of a third party repository.</span><br><span class=\"line\">\t\tapt-get install -y openvpn iptables openssl wget ca-certificates curl</span><br><span class=\"line\">\telif [[ &quot;$OS&quot; = &#x27;centos&#x27; ]]; then</span><br><span class=\"line\">\t\tyum install -y epel-release</span><br><span class=\"line\">\t\tyum install -y openvpn iptables openssl wget ca-certificates curl</span><br><span class=\"line\">\telif [[ &quot;$OS&quot; = &#x27;fedora&#x27; ]]; then</span><br><span class=\"line\">\t\tdnf install -y openvpn iptables openssl wget ca-certificates curl</span><br><span class=\"line\">\telif [[ &quot;$OS&quot; = &#x27;arch&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;警告：当您使用ArchLinux时，我需要更新系统上的软件包以安装我需要的软件包.&quot;</span><br><span class=\"line\">\t\techo &quot;不这样做可能会导致依赖关系之间出现问题，或者丢失存储库中的文件（Arch Linux不支持部分升级）.&quot;</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;继续将更新您安装的软件包并安装所需的软件包.&quot;</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tunset CONTINUE</span><br><span class=\"line\">\t\tuntil [[ $CONTINUE =~ (y|n) ]]; do</span><br><span class=\"line\">\t\t\tread -rp &quot;继续? [y/n]: &quot; -e -i y CONTINUE</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\t\tif [[ &quot;$CONTINUE&quot; = &quot;n&quot; ]]; then</span><br><span class=\"line\">\t\t\techo &quot;终止安装 是用户不允许更新系统.&quot;</span><br><span class=\"line\">\t\t\texit 4</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Install required dependencies and upgrade the system</span><br><span class=\"line\">\t\tpacman --needed --noconfirm -Syu openvpn iptables openssl wget ca-certificates curl</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Find out if the machine uses nogroup or nobody for the permissionless group</span><br><span class=\"line\">\tif grep -qs &quot;^nogroup:&quot; /etc/group; then</span><br><span class=\"line\">\t\tNOGROUP=nogroup</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\tNOGROUP=nobody</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# An old version of easy-rsa was available by default in some openvpn packages</span><br><span class=\"line\">\tif [[ -d /etc/openvpn/easy-rsa/ ]]; then</span><br><span class=\"line\">\t\trm -rf /etc/openvpn/easy-rsa/</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Install the latest version of easy-rsa from source</span><br><span class=\"line\">\tlocal version=&quot;3.0.5&quot;</span><br><span class=\"line\">\twget -O ~/EasyRSA-nix-$&#123;version&#125;.tgz https://github.com/OpenVPN/easy-rsa/releases/download/v$&#123;version&#125;/EasyRSA-nix-$&#123;version&#125;.tgz</span><br><span class=\"line\">\ttar xzf ~/EasyRSA-nix-$&#123;version&#125;.tgz -C ~/</span><br><span class=\"line\">\tmv ~/EasyRSA-$&#123;version&#125;/ /etc/openvpn/</span><br><span class=\"line\">\tmv /etc/openvpn/EasyRSA-$&#123;version&#125;/ /etc/openvpn/easy-rsa/</span><br><span class=\"line\">\tchown -R root:root /etc/openvpn/easy-rsa/</span><br><span class=\"line\">\trm -f ~/EasyRSA-nix-$&#123;version&#125;.tgz</span><br><span class=\"line\"></span><br><span class=\"line\">\tcd /etc/openvpn/easy-rsa/</span><br><span class=\"line\">\tcase $CERT_TYPE in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\techo &quot;set_var EASYRSA_ALGO ec&quot; &gt; vars</span><br><span class=\"line\">\t\t\techo &quot;set_var EASYRSA_CURVE $CERT_CURVE&quot; &gt;&gt; vars</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\t\techo &quot;set_var EASYRSA_KEY_SIZE $RSA_KEY_SIZE&quot; &gt; vars</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Generate a random, alphanumeric identifier of 16 characters for CN and one for server name</span><br><span class=\"line\">\tSERVER_CN=&quot;cn_$(head /dev/urandom | tr -dc &#x27;a-zA-Z0-9&#x27; | fold -w 16 | head -n 1)&quot;</span><br><span class=\"line\">\tSERVER_NAME=&quot;server_$(head /dev/urandom | tr -dc &#x27;a-zA-Z0-9&#x27; | fold -w 16 | head -n 1)&quot;</span><br><span class=\"line\">\techo &quot;set_var EASYRSA_REQ_CN $SERVER_CN&quot; &gt;&gt; vars</span><br><span class=\"line\">\t# Create the PKI, set up the CA, the DH params and the server certificate</span><br><span class=\"line\">\t./easyrsa init-pki</span><br><span class=\"line\">\t./easyrsa --batch build-ca nopass</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ $DH_TYPE == &quot;2&quot; ]]; then</span><br><span class=\"line\">\t\t# ECDH keys are generated on-the-fly so we don&#x27;t need to generate them beforehand</span><br><span class=\"line\">\t\topenssl dhparam -out dh.pem $DH_KEY_SIZE</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t./easyrsa build-server-full &quot;$SERVER_NAME&quot; nopass</span><br><span class=\"line\">\tEASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl</span><br><span class=\"line\"></span><br><span class=\"line\">\tcase $TLS_SIG in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\t# Generate tls-crypt key</span><br><span class=\"line\">\t\t\topenvpn --genkey --secret /etc/openvpn/tls-crypt.key</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\t\t# Generate tls-auth key</span><br><span class=\"line\">\t\t\topenvpn --genkey --secret /etc/openvpn/tls-auth.key</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Move all the generated files</span><br><span class=\"line\">\tcp pki/ca.crt pki/private/ca.key &quot;pki/issued/$SERVER_NAME.crt&quot; &quot;pki/private/$SERVER_NAME.key&quot; /etc/openvpn/easy-rsa/pki/crl.pem /etc/openvpn</span><br><span class=\"line\">\tif [[ $DH_TYPE == &quot;2&quot; ]]; then</span><br><span class=\"line\">\t\tcp dh.pem /etc/openvpn</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Make cert revocation list readable for non-root</span><br><span class=\"line\">\tchmod 644 /etc/openvpn/crl.pem</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Generate server.conf</span><br><span class=\"line\">\techo &quot;port $PORT&quot; &gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\tif [[ &quot;$IPV6_SUPPORT&quot; = &#x27;n&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;proto $PROTOCOL&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\telif [[ &quot;$IPV6_SUPPORT&quot; = &#x27;y&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;proto $&#123;PROTOCOL&#125;6&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;dev tun</span><br><span class=\"line\">user nobody</span><br><span class=\"line\">group $NOGROUP</span><br><span class=\"line\">persist-key</span><br><span class=\"line\">persist-tun</span><br><span class=\"line\">keepalive 10 120</span><br><span class=\"line\">topology subnet</span><br><span class=\"line\">server 10.8.0.0 255.255.255.0</span><br><span class=\"line\">ifconfig-pool-persist ipp.txt&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\"></span><br><span class=\"line\">\t# DNS resolvers</span><br><span class=\"line\">\tcase $DNS in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\t# Locate the proper resolv.conf</span><br><span class=\"line\">\t\t\t# Needed for systems running systemd-resolved</span><br><span class=\"line\">\t\t\tif grep -q &quot;127.0.0.53&quot; &quot;/etc/resolv.conf&quot;; then</span><br><span class=\"line\">\t\t\t\tRESOLVCONF=&#x27;/run/systemd/resolve/resolv.conf&#x27;</span><br><span class=\"line\">\t\t\telse</span><br><span class=\"line\">\t\t\t\tRESOLVCONF=&#x27;/etc/resolv.conf&#x27;</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\t\t\t# Obtain the resolvers from resolv.conf and use them for OpenVPN</span><br><span class=\"line\">\t\t\tgrep -v &#x27;#&#x27; $RESOLVCONF | grep &#x27;nameserver&#x27; | grep -E -o &#x27;[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;&#x27; | while read -r line; do</span><br><span class=\"line\">\t\t\t\techo &quot;push \\&quot;dhcp-option DNS $line\\&quot;&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\tdone</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 10.8.0.1&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t3) # Cloudflare</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 1.0.0.1&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 1.1.1.1&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t4) # Quad9</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 9.9.9.9&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 149.112.112.112&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t5) # Quad9 uncensored</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 9.9.9.10&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 149.112.112.10&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t6) # FDN</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 80.67.169.40&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 80.67.169.12&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t7) # DNS.WATCH</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 84.200.69.80&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 84.200.70.40&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t8) # OpenDNS</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 208.67.222.222&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 208.67.220.220&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t9) # Google</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 8.8.8.8&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 8.8.4.4&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t10) # Yandex Basic</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 77.88.8.8&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 77.88.8.1&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t11) # AdGuard DNS</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 176.103.130.130&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t\techo &#x27;push &quot;dhcp-option DNS 176.103.130.131&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\">\techo &#x27;push &quot;redirect-gateway def1 bypass-dhcp&quot; &#x27;&gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\"></span><br><span class=\"line\">\t# IPv6 network settings if needed</span><br><span class=\"line\">\tif [[ &quot;$IPV6_SUPPORT&quot; = &#x27;y&#x27; ]]; then</span><br><span class=\"line\">\t\techo &#x27;server-ipv6 fd42:42:42:42::/112</span><br><span class=\"line\">tun-ipv6</span><br><span class=\"line\">push tun-ipv6</span><br><span class=\"line\">push &quot;route-ipv6 2000::/3&quot;</span><br><span class=\"line\">push &quot;redirect-gateway ipv6&quot;&#x27; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ $COMPRESSION_ENABLED == &quot;y&quot;  ]]; then</span><br><span class=\"line\">\t\techo &quot;compress $COMPRESSION_ALG&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ $DH_TYPE == &quot;1&quot; ]]; then</span><br><span class=\"line\">\t\techo &quot;dh none&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\techo &quot;ecdh-curve $DH_CURVE&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\telif [[ $DH_TYPE == &quot;2&quot; ]]; then</span><br><span class=\"line\">\t\techo &quot;dh dh.pem&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\tcase $TLS_SIG in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\techo &quot;tls-crypt tls-crypt.key 0&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\t\techo &quot;tls-auth tls-auth.key 0&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;crl-verify crl.pem</span><br><span class=\"line\">ca ca.crt</span><br><span class=\"line\">cert $SERVER_NAME.crt</span><br><span class=\"line\">key $SERVER_NAME.key </span><br><span class=\"line\">auth $HMAC_ALG</span><br><span class=\"line\">cipher $CIPHER</span><br><span class=\"line\">ncp-ciphers $CIPHER</span><br><span class=\"line\">tls-server</span><br><span class=\"line\">tls-version-min 1.2</span><br><span class=\"line\">tls-cipher $CC_CIPHER</span><br><span class=\"line\">status /var/log/openvpn/status.log</span><br><span class=\"line\">verb 3&quot; &gt;&gt; /etc/openvpn/server.conf</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Create log dir</span><br><span class=\"line\">\tmkdir -p /var/log/openvpn</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Enable routing</span><br><span class=\"line\">\techo &#x27;net.ipv4.ip_forward=1&#x27; &gt;&gt; /etc/sysctl.d/20-openvpn.conf</span><br><span class=\"line\">\tif [[ &quot;$IPV6_SUPPORT&quot; = &#x27;y&#x27; ]]; then</span><br><span class=\"line\">\t\techo &#x27;net.ipv6.conf.all.forwarding=1&#x27; &gt;&gt; /etc/sysctl.d/20-openvpn.conf</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t# Avoid an unneeded reboot</span><br><span class=\"line\">\tsysctl --system</span><br><span class=\"line\"></span><br><span class=\"line\">\t# If SELinux is enabled and a custom port was selected, we need this</span><br><span class=\"line\">\tif hash sestatus 2&gt;/dev/null; then</span><br><span class=\"line\">\t\tif sestatus | grep &quot;Current mode&quot; | grep -qs &quot;enforcing&quot;; then</span><br><span class=\"line\">\t\t\tif [[ &quot;$PORT&quot; != &#x27;1194&#x27; ]]; then</span><br><span class=\"line\">\t\t\t\tsemanage port -a -t openvpn_port_t -p &quot;$PROTOCOL&quot; &quot;$PORT&quot;</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Finally, restart and enable OpenVPN</span><br><span class=\"line\">\tif [[ &quot;$OS&quot; = &#x27;arch&#x27; || &quot;$OS&quot; = &#x27;fedora&#x27; ]]; then</span><br><span class=\"line\">\t\t# Don&#x27;t modify package-provided service</span><br><span class=\"line\">\t\tcp /usr/lib/systemd/system/openvpn-server@.service /etc/systemd/system/openvpn-server@.service</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Workaround to fix OpenVPN service on OpenVZ</span><br><span class=\"line\">\t\tsed -i &#x27;s|LimitNPROC|#LimitNPROC|&#x27; /etc/systemd/system/openvpn-server@.service</span><br><span class=\"line\">\t\t# Another workaround to keep using /etc/openvpn/</span><br><span class=\"line\">\t\tsed -i &#x27;s|/etc/openvpn/server|/etc/openvpn|&#x27; /etc/systemd/system/openvpn-server@.service</span><br><span class=\"line\">\t\t# On fedora, the service hardcodes the ciphers. We want to manage the cipher ourselves, so we remove it from the service</span><br><span class=\"line\">\t\tif [[ &quot;$OS&quot; == &quot;fedora&quot; ]];then</span><br><span class=\"line\">\t\t\tsed -i &#x27;s|--cipher AES-256-GCM --ncp-ciphers AES-256-GCM:AES-128-GCM:AES-256-CBC:AES-128-CBC:BF-CBC||&#x27; /etc/systemd/system/openvpn-server@.service</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tsystemctl daemon-reload</span><br><span class=\"line\">\t\tsystemctl restart openvpn-server@server</span><br><span class=\"line\">\t\tsystemctl enable openvpn-server@server</span><br><span class=\"line\">\telif [[ &quot;$OS&quot; == &quot;ubuntu&quot; ]] &amp;&amp; [[ &quot;$VERSION_ID&quot; == &quot;16.04&quot; ]]; then</span><br><span class=\"line\">\t\t# On Ubuntu 16.04, we use the package from the OpenVPN repo</span><br><span class=\"line\">\t\t# This package uses a sysvinit service</span><br><span class=\"line\">\t\tsystemctl enable openvpn</span><br><span class=\"line\">\t\tsystemctl start openvpn</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\t# Don&#x27;t modify package-provided service</span><br><span class=\"line\">\t\tcp /lib/systemd/system/openvpn\\@.service /etc/systemd/system/openvpn\\@.service</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Workaround to fix OpenVPN service on OpenVZ</span><br><span class=\"line\">\t\tsed -i &#x27;s|LimitNPROC|#LimitNPROC|&#x27; /etc/systemd/system/openvpn\\@.service</span><br><span class=\"line\">\t\t# Another workaround to keep using /etc/openvpn/</span><br><span class=\"line\">\t\tsed -i &#x27;s|/etc/openvpn/server|/etc/openvpn|&#x27; /etc/systemd/system/openvpn\\@.service</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tsystemctl daemon-reload</span><br><span class=\"line\">\t\tsystemctl restart openvpn@server</span><br><span class=\"line\">\t\tsystemctl enable openvpn@server</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ $DNS == 2 ]];then</span><br><span class=\"line\">\t\tinstallUnbound</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Add iptables rules in two scripts</span><br><span class=\"line\">\tmkdir /etc/iptables</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Script to add rules</span><br><span class=\"line\">\techo &quot;#!/bin/sh</span><br><span class=\"line\">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o $NIC -j MASQUERADE</span><br><span class=\"line\">iptables -A INPUT -i tun0 -j ACCEPT</span><br><span class=\"line\">iptables -A FORWARD -i $NIC -o tun0 -j ACCEPT</span><br><span class=\"line\">iptables -A FORWARD -i tun0 -o $NIC -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -i $NIC -p $PROTOCOL --dport $PORT -j ACCEPT&quot; &gt; /etc/iptables/add-openvpn-rules.sh</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ &quot;$IPV6_SUPPORT&quot; = &#x27;y&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;ip6tables -t nat -A POSTROUTING -s fd42:42:42:42::/112 -o $NIC -j MASQUERADE</span><br><span class=\"line\">ip6tables -A INPUT -i tun0 -j ACCEPT</span><br><span class=\"line\">ip6tables -A FORWARD -i $NIC -o tun0 -j ACCEPT</span><br><span class=\"line\">ip6tables -A FORWARD -i tun0 -o $NIC -j ACCEPT&quot; &gt;&gt; /etc/iptables/add-openvpn-rules.sh</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Script to remove rules</span><br><span class=\"line\">\techo &quot;#!/bin/sh</span><br><span class=\"line\">iptables -t nat -D POSTROUTING -s 10.8.0.0/24 -o $NIC -j MASQUERADE</span><br><span class=\"line\">iptables -D INPUT -i tun0 -j ACCEPT</span><br><span class=\"line\">iptables -D FORWARD -i $NIC -o tun0 -j ACCEPT</span><br><span class=\"line\">iptables -D FORWARD -i tun0 -o $NIC -j ACCEPT</span><br><span class=\"line\">iptables -D INPUT -i $NIC -p $PROTOCOL --dport $PORT -j ACCEPT&quot; &gt; /etc/iptables/rm-openvpn-rules.sh</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ &quot;$IPV6_SUPPORT&quot; = &#x27;y&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;ip6tables -t nat -D POSTROUTING -s fd42:42:42:42::/112 -o $NIC -j MASQUERADE</span><br><span class=\"line\">ip6tables -D INPUT -i tun0 -j ACCEPT</span><br><span class=\"line\">ip6tables -D FORWARD -i $NIC -o tun0 -j ACCEPT</span><br><span class=\"line\">ip6tables -D FORWARD -i tun0 -o $NIC -j ACCEPT&quot; &gt;&gt; /etc/iptables/rm-openvpn-rules.sh</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\tchmod +x /etc/iptables/add-openvpn-rules.sh</span><br><span class=\"line\">\tchmod +x /etc/iptables/rm-openvpn-rules.sh</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Handle the rules via a systemd script</span><br><span class=\"line\">\techo &quot;[Unit]</span><br><span class=\"line\">Description=iptables rules for OpenVPN</span><br><span class=\"line\">Before=network-online.target</span><br><span class=\"line\">Wants=network-online.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=oneshot</span><br><span class=\"line\">ExecStart=/etc/iptables/add-openvpn-rules.sh</span><br><span class=\"line\">ExecStop=/etc/iptables/rm-openvpn-rules.sh</span><br><span class=\"line\">RemainAfterExit=yes</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target&quot; &gt; /etc/systemd/system/iptables-openvpn.service</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Enable service and apply rules</span><br><span class=\"line\">\tsystemctl daemon-reload</span><br><span class=\"line\">\tsystemctl enable iptables-openvpn</span><br><span class=\"line\">\tsystemctl start iptables-openvpn</span><br><span class=\"line\"></span><br><span class=\"line\">\t# If the server is behind a NAT, use the correct IP address for the clients to connect to</span><br><span class=\"line\">\tif [[ &quot;$PUBLICIP&quot; != &quot;&quot; ]]; then</span><br><span class=\"line\">\t\tIP=$PUBLICIP</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# client-template.txt is created so we have a template to add further users later</span><br><span class=\"line\">\techo &quot;client&quot; &gt; /etc/openvpn/client-template.txt</span><br><span class=\"line\">\tif [[ &quot;$PROTOCOL&quot; = &#x27;udp&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;proto udp&quot; &gt;&gt; /etc/openvpn/client-template.txt</span><br><span class=\"line\">\telif [[ &quot;$PROTOCOL&quot; = &#x27;tcp&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;proto tcp-client&quot; &gt;&gt; /etc/openvpn/client-template.txt</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\techo &quot;remote $IP $PORT</span><br><span class=\"line\">dev tun</span><br><span class=\"line\">resolv-retry infinite</span><br><span class=\"line\">nobind</span><br><span class=\"line\">persist-key</span><br><span class=\"line\">persist-tun</span><br><span class=\"line\">remote-cert-tls server</span><br><span class=\"line\">verify-x509-name $SERVER_NAME name</span><br><span class=\"line\">auth $HMAC_ALG</span><br><span class=\"line\">auth-nocache</span><br><span class=\"line\">cipher $CIPHER</span><br><span class=\"line\">tls-client</span><br><span class=\"line\">tls-version-min 1.2</span><br><span class=\"line\">tls-cipher $CC_CIPHER</span><br><span class=\"line\">setenv opt block-outside-dns # Prevent Windows 10 DNS leak</span><br><span class=\"line\">verb 3&quot; &gt;&gt; /etc/openvpn/client-template.txt</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ $COMPRESSION_ENABLED == &quot;y&quot;  ]]; then</span><br><span class=\"line\">\techo &quot;compress $COMPRESSION_ALG&quot; &gt;&gt; /etc/openvpn/client-template.txt</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Generate the custom client.ovpn</span><br><span class=\"line\">\tnewClient</span><br><span class=\"line\">\techo &quot;如果要添加更多客户端，只需再次运行此脚本即可&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function newClient () &#123;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;输入用户的用户名.&quot;</span><br><span class=\"line\">\techo &quot;请不要输入特殊字符.&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\tuntil [[ &quot;$CLIENT&quot; =~ ^[a-zA-Z0-9_]+$ ]]; do</span><br><span class=\"line\">\t\tread -rp &quot;用户名: &quot; -e CLIENT</span><br><span class=\"line\">\tdone</span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;是否要使用密码认证配置文件?&quot;</span><br><span class=\"line\">\techo &quot;(e.g. 使用密码加密私钥)&quot;</span><br><span class=\"line\">\techo &quot;   1) 添加一个不需要密码的用户&quot;</span><br><span class=\"line\">\techo &quot;   2) 添加一个需要密码的用户&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\tuntil [[ &quot;$PASS&quot; =~ ^[1-2]$ ]]; do</span><br><span class=\"line\">\t\tread -rp &quot;Select an option [1-2]: &quot; -e -i 1 PASS</span><br><span class=\"line\">\tdone</span><br><span class=\"line\"></span><br><span class=\"line\">\tcd /etc/openvpn/easy-rsa/ || return</span><br><span class=\"line\">\tcase $PASS in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\t./easyrsa build-client-full &quot;$CLIENT&quot; nopass</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\techo &quot;⚠️ 您将被要求提供用户的密码 ⚠️&quot;</span><br><span class=\"line\">\t\t\t./easyrsa build-client-full &quot;$CLIENT&quot;</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Home directory of the user, where the client configuration (.ovpn) will be written</span><br><span class=\"line\">\tif [ -e &quot;/home/$CLIENT&quot; ]; then  # if $1 is a user name</span><br><span class=\"line\">\t\thomeDir=&quot;/home/$CLIENT&quot;</span><br><span class=\"line\">\telif [ &quot;$&#123;SUDO_USER&#125;&quot; ]; then   # if not, use SUDO_USER</span><br><span class=\"line\">\t\thomeDir=&quot;/home/$&#123;SUDO_USER&#125;&quot;</span><br><span class=\"line\">\telse  # if not SUDO_USER, use /root</span><br><span class=\"line\">\t\thomeDir=&quot;/root&quot;</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Determine if we use tls-auth or tls-crypt</span><br><span class=\"line\">\tif grep -qs &quot;^tls-crypt&quot; /etc/openvpn/server.conf; then</span><br><span class=\"line\">\t\tTLS_SIG=&quot;1&quot;</span><br><span class=\"line\">\telif grep -qs &quot;^tls-auth&quot; /etc/openvpn/server.conf; then</span><br><span class=\"line\">\t\tTLS_SIG=&quot;2&quot;</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t# Generates the custom client.ovpn</span><br><span class=\"line\">\tcp /etc/openvpn/client-template.txt &quot;$homeDir/$CLIENT.ovpn&quot;</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\techo &quot;&lt;ca&gt;&quot;</span><br><span class=\"line\">\t\tcat &quot;/etc/openvpn/easy-rsa/pki/ca.crt&quot;</span><br><span class=\"line\">\t\techo &quot;&lt;/ca&gt;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\techo &quot;&lt;cert&gt;&quot;</span><br><span class=\"line\">\t\tawk &#x27;/BEGIN/,/END/&#x27; &quot;/etc/openvpn/easy-rsa/pki/issued/$CLIENT.crt&quot;</span><br><span class=\"line\">\t\techo &quot;&lt;/cert&gt;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\techo &quot;&lt;key&gt;&quot;</span><br><span class=\"line\">\t\tcat &quot;/etc/openvpn/easy-rsa/pki/private/$CLIENT.key&quot;</span><br><span class=\"line\">\t\techo &quot;&lt;/key&gt;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tcase $TLS_SIG in</span><br><span class=\"line\">\t\t\t1)</span><br><span class=\"line\">\t\t\t\techo &quot;&lt;tls-crypt&gt;&quot;</span><br><span class=\"line\">\t\t\t\tcat /etc/openvpn/tls-crypt.key</span><br><span class=\"line\">\t\t\t\techo &quot;&lt;/tls-crypt&gt;&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\t\t2)</span><br><span class=\"line\">\t\t\t\techo &quot;key-direction 1&quot;</span><br><span class=\"line\">\t\t\t\techo &quot;&lt;tls-auth&gt;&quot;</span><br><span class=\"line\">\t\t\t\tcat /etc/openvpn/tls-auth.key</span><br><span class=\"line\">\t\t\t\techo &quot;&lt;/tls-auth&gt;&quot;</span><br><span class=\"line\">\t\t\t;;</span><br><span class=\"line\">\t\tesac</span><br><span class=\"line\">\t&#125; &gt;&gt; &quot;$homeDir/$CLIENT.ovpn&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;Client $CLIENT added, the configuration file is available at $homeDir/$CLIENT.ovpn.&quot;</span><br><span class=\"line\">\techo &quot;下载 .ovpn 配置文件并且导入到你的OpenVPN客户端.&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function revokeClient () &#123;</span><br><span class=\"line\">\tNUMBEROFCLIENTS=$(tail -n +2 /etc/openvpn/easy-rsa/pki/index.txt | grep -c &quot;^V&quot;)</span><br><span class=\"line\">\tif [[ &quot;$NUMBEROFCLIENTS&quot; = &#x27;0&#x27; ]]; then</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;当前没有用户!&quot;</span><br><span class=\"line\">\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;Select the existing client certificate you want to revoke&quot;</span><br><span class=\"line\">\ttail -n +2 /etc/openvpn/easy-rsa/pki/index.txt | grep &quot;^V&quot; | cut -d &#x27;=&#x27; -f 2 | nl -s &#x27;) &#x27;</span><br><span class=\"line\">\tif [[ &quot;$NUMBEROFCLIENTS&quot; = &#x27;1&#x27; ]]; then</span><br><span class=\"line\">\t\tread -rp &quot;选择一个用户 [1]: &quot; CLIENTNUMBER</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\tread -rp &quot;选择一个用户 [1-$NUMBEROFCLIENTS]: &quot; CLIENTNUMBER</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\tCLIENT=$(tail -n +2 /etc/openvpn/easy-rsa/pki/index.txt | grep &quot;^V&quot; | cut -d &#x27;=&#x27; -f 2 | sed -n &quot;$CLIENTNUMBER&quot;p)</span><br><span class=\"line\">\tcd /etc/openvpn/easy-rsa/</span><br><span class=\"line\">\t./easyrsa --batch revoke &quot;$CLIENT&quot;</span><br><span class=\"line\">\tEASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl</span><br><span class=\"line\">\t# Cleanup</span><br><span class=\"line\">\trm -f &quot;pki/reqs/$CLIENT.req&quot;</span><br><span class=\"line\">\trm -f &quot;pki/private/$CLIENT.key&quot;</span><br><span class=\"line\">\trm -f &quot;pki/issued/$CLIENT.crt&quot;</span><br><span class=\"line\">\trm -f /etc/openvpn/crl.pem</span><br><span class=\"line\">\tcp /etc/openvpn/easy-rsa/pki/crl.pem /etc/openvpn/crl.pem</span><br><span class=\"line\">\tchmod 644 /etc/openvpn/crl.pem</span><br><span class=\"line\">\tfind /home/ -maxdepth 2 -name &quot;$CLIENT.ovpn&quot; -delete</span><br><span class=\"line\">\trm -f &quot;/root/$CLIENT.ovpn&quot;</span><br><span class=\"line\">\tsed -i &quot;s|^$CLIENT,.*||&quot; /etc/openvpn/ipp.txt</span><br><span class=\"line\"></span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;客户端证书 $CLIENT 已经移除.&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function removeUnbound () &#123;</span><br><span class=\"line\">\t# Remove OpenVPN-related config</span><br><span class=\"line\">\tsed -i &#x27;s|include: \\/etc\\/unbound\\/openvpn.conf||&#x27; /etc/unbound/unbound.conf</span><br><span class=\"line\">\trm /etc/unbound/openvpn.conf</span><br><span class=\"line\">\tsystemctl restart unbound</span><br><span class=\"line\"></span><br><span class=\"line\">\tuntil [[ $REMOVE_UNBOUND =~ (y|n) ]]; do</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;如果您在安装OpenVPN之前已经使用了Unbound，我删除了与OpenVPN相关的配置.&quot;</span><br><span class=\"line\">\t\tread -rp &quot;确定完全删除 Unbound? [y/n]: &quot; -e REMOVE_UNBOUND</span><br><span class=\"line\">\tdone</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [[ &quot;$REMOVE_UNBOUND&quot; = &#x27;y&#x27; ]]; then</span><br><span class=\"line\">\t\t# Stop Unbound</span><br><span class=\"line\">\t\tsystemctl stop unbound</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif [[ &quot;$OS&quot; =~ (debian|ubuntu) ]]; then</span><br><span class=\"line\">\t\t\tapt-get autoremove --purge -y unbound</span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &#x27;arch&#x27; ]]; then</span><br><span class=\"line\">\t\t\tpacman --noconfirm -R unbound</span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &#x27;centos&#x27; ]]; then</span><br><span class=\"line\">\t\t\tyum remove -y unbound</span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &#x27;fedora&#x27; ]]; then</span><br><span class=\"line\">\t\t\tdnf remove -y unbound</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\trm -rf /etc/unbound/</span><br><span class=\"line\"></span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;Unbound 删除成功!&quot;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;Unbound 删除终止.&quot;</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function removeOpenVPN () &#123;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\tread -rp &quot;确定要卸载OpenVPN? [y/n]: &quot; -e -i n REMOVE</span><br><span class=\"line\">\tif [[ &quot;$REMOVE&quot; = &#x27;y&#x27; ]]; then</span><br><span class=\"line\">\t\t# Get OpenVPN port from the configuration</span><br><span class=\"line\">\t\tPORT=$(grep &#x27;^port &#x27; /etc/openvpn/server.conf | cut -d &quot; &quot; -f 2)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Stop OpenVPN</span><br><span class=\"line\">\t\tif [[ &quot;$OS&quot; =~ (fedora|arch) ]]; then</span><br><span class=\"line\">\t\t\tsystemctl disable openvpn-server@server</span><br><span class=\"line\">\t\t\tsystemctl stop openvpn-server@server</span><br><span class=\"line\">\t\t\t# Remove customised service</span><br><span class=\"line\">\t\t\trm /etc/systemd/system/openvpn-server@.service</span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; == &quot;ubuntu&quot; ]] &amp;&amp; [[ &quot;$VERSION_ID&quot; == &quot;16.04&quot; ]]; then</span><br><span class=\"line\">\t\t\tsystemctl disable openvpn</span><br><span class=\"line\">\t\t\tsystemctl stop openvpn</span><br><span class=\"line\">\t\telse</span><br><span class=\"line\">\t\t\tsystemctl disable openvpn@server</span><br><span class=\"line\">\t\t\tsystemctl stop openvpn@server</span><br><span class=\"line\">\t\t\t# Remove customised service</span><br><span class=\"line\">\t\t\trm /etc/systemd/system/openvpn\\@.service</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Remove the iptables rules related to the script</span><br><span class=\"line\">\t\tsystemctl stop iptables-openvpn</span><br><span class=\"line\">\t\t# Cleanup</span><br><span class=\"line\">\t\tsystemctl disable iptables-openvpn</span><br><span class=\"line\">\t\trm /etc/systemd/system/iptables-openvpn.service</span><br><span class=\"line\">\t\tsystemctl daemon-reload</span><br><span class=\"line\">\t\trm /etc/iptables/add-openvpn-rules.sh</span><br><span class=\"line\">\t\trm /etc/iptables/rm-openvpn-rules.sh</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# SELinux</span><br><span class=\"line\">\t\tif hash sestatus 2&gt;/dev/null; then</span><br><span class=\"line\">\t\t\tif sestatus | grep &quot;Current mode&quot; | grep -qs &quot;enforcing&quot;; then</span><br><span class=\"line\">\t\t\t\tif [[ &quot;$PORT&quot; != &#x27;1194&#x27; ]]; then</span><br><span class=\"line\">\t\t\t\t\tsemanage port -d -t openvpn_port_t -p udp &quot;$PORT&quot;</span><br><span class=\"line\">\t\t\t\tfi</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif [[ &quot;$OS&quot; =~ (debian|ubuntu) ]]; then</span><br><span class=\"line\">\t\t\tapt-get autoremove --purge -y openvpn</span><br><span class=\"line\">\t\t\tif [[ -e /etc/apt/sources.list.d/openvpn.list ]];then</span><br><span class=\"line\">\t\t\t\trm /etc/apt/sources.list.d/openvpn.list</span><br><span class=\"line\">\t\t\t\tapt-get update</span><br><span class=\"line\">\t\t\tfi</span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &#x27;arch&#x27; ]]; then</span><br><span class=\"line\">\t\t\tpacman --noconfirm -R openvpn</span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &#x27;centos&#x27; ]]; then</span><br><span class=\"line\">\t\t\tyum remove -y openvpn</span><br><span class=\"line\">\t\telif [[ &quot;$OS&quot; = &#x27;fedora&#x27; ]]; then</span><br><span class=\"line\">\t\t\tdnf remove -y openvpn</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Cleanup</span><br><span class=\"line\">\t\tfind /home/ -maxdepth 2 -name &quot;*.ovpn&quot; -delete</span><br><span class=\"line\">\t\tfind /root/ -maxdepth 1 -name &quot;*.ovpn&quot; -delete</span><br><span class=\"line\">\t\trm -rf /etc/openvpn</span><br><span class=\"line\">\t\trm -rf /usr/share/doc/openvpn*</span><br><span class=\"line\">\t\trm -f /etc/sysctl.d/20-openvpn.conf</span><br><span class=\"line\">\t\trm -rf /var/log/openvpn</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# Unbound</span><br><span class=\"line\">\t\tif [[ -e /etc/unbound/openvpn.conf ]]; then</span><br><span class=\"line\">\t\t\tremoveUnbound</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;OpenVPN 卸载成功!&quot;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\techo &quot;卸载终止!&quot;</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function manageMenu () &#123;</span><br><span class=\"line\">\tclear</span><br><span class=\"line\">\techo &quot;欢迎使用OpenVPN一键脚本!&quot;</span><br><span class=\"line\">\techo &quot;脚本原作者: https://github.com/angristan/openvpn-install&quot;</span><br><span class=\"line\">\techo &quot;脚本汉化: pingchuan&quot;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;OpenVPN 已经正常安装.&quot;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\">\techo &quot;请选择你要进行的操作?&quot;</span><br><span class=\"line\">\techo &quot;   1) 添加一个用户&quot;</span><br><span class=\"line\">\techo &quot;   2) 删除一个存在的用户&quot;</span><br><span class=\"line\">\techo &quot;   3) 卸载OpenVPN&quot;</span><br><span class=\"line\">\techo &quot;   4) 退出&quot;</span><br><span class=\"line\">\tuntil [[ &quot;$MENU_OPTION&quot; =~ ^[1-4]$ ]]; do</span><br><span class=\"line\">\t\tread -rp &quot;选择选项 [1-4]: &quot; MENU_OPTION</span><br><span class=\"line\">\tdone</span><br><span class=\"line\"></span><br><span class=\"line\">\tcase $MENU_OPTION in</span><br><span class=\"line\">\t\t1)</span><br><span class=\"line\">\t\t\tnewClient</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t2)</span><br><span class=\"line\">\t\t\trevokeClient</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t3)</span><br><span class=\"line\">\t\t\tremoveOpenVPN</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t\t4)</span><br><span class=\"line\">\t\t\texit 0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Check for root, TUN, OS...</span><br><span class=\"line\">initialCheck</span><br><span class=\"line\"></span><br><span class=\"line\"># Check if OpenVPN is already installed</span><br><span class=\"line\">if [[ -e /etc/openvpn/server.conf ]]; then</span><br><span class=\"line\">\tmanageMenu</span><br><span class=\"line\">else</span><br><span class=\"line\">\tinstallOpenVPN</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","text":"直接展示脚本12345678910111213141516171819202122232425262728293031323334353637383940414...","permalink":"/post/搭建OpenVPN一键脚本","photos":[],"count_time":{"symbolsCount":"42k","symbolsTime":"38 mins."},"categories":[{"name":"OpenVPN","slug":"OpenVPN","count":1,"path":"api/categories/OpenVPN.json"}],"tags":[{"name":"OpenVPN","slug":"OpenVPN","count":1,"path":"api/tags/OpenVPN.json"},{"name":"开源","slug":"开源","count":1,"path":"api/tags/开源.json"},{"name":"Linux","slug":"Linux","count":1,"path":"api/tags/Linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%9B%B4%E6%8E%A5%E5%B1%95%E7%A4%BA%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">直接展示脚本</span></a></li></ol>","author":{"name":"Chuan","slug":"blog-author","avatar":"https://tuchuan.yunlianzhigong.com/i/2024/09/30/pe8plz.png","link":"/","description":"一个精神探索者，不断深入探索信仰的深度和灵魂追求平静之旅的美丽。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"在禁食中操练成长","uid":"37eadf13cf8e6f83452d28040d5362dd","slug":"在禁食中操练成长","date":"2024-09-30T03:00:36.170Z","updated":"2024-09-30T05:19:24.200Z","comments":true,"path":"api/articles/在禁食中操练成长.json","keywords":null,"cover":[],"text":" 扎根基督，向上成长，这里是《成主学堂》。我是张凡！在我日常的工作中，会有一些不同的任务和事务需要处理，但是我非常享受的一件就是安安静静的阅读大家的来信，无论是...","permalink":"/post/在禁食中操练成长","photos":[],"count_time":{"symbolsCount":"4.3k","symbolsTime":"4 mins."},"categories":[{"name":"基督","slug":"基督","count":1,"path":"api/categories/基督.json"},{"name":"天主","slug":"天主","count":1,"path":"api/categories/天主.json"}],"tags":[{"name":"基督教","slug":"基督教","count":1,"path":"api/tags/基督教.json"},{"name":"天主","slug":"天主","count":1,"path":"api/tags/天主.json"},{"name":"上帝","slug":"上帝","count":1,"path":"api/tags/上帝.json"},{"name":"禁食","slug":"禁食","count":1,"path":"api/tags/禁食.json"}],"author":{"name":"Chuan","slug":"blog-author","avatar":"https://tuchuan.yunlianzhigong.com/i/2024/09/30/pe8plz.png","link":"/","description":"一个精神探索者，不断深入探索信仰的深度和灵魂追求平静之旅的美丽。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}